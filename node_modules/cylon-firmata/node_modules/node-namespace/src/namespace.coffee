defineNamespace = (defaultContext = this)->
  _namespace = (ns, context, func)->
    if not func?
      func = context
      context = defaultContext

    chain = ns.split '.'
    name = chain.shift()

    if not context[name]?
      context[name] = {}
    else if !context[name]? or (context[name].toString() != '[object Object]')
      throw new Error "Namespace part '#{name}' can not be created"

    if chain.length == 0
      func.call context[name]
    else
      _namespace chain.join('.'), context[name], func

if module? && module.exports?
  module.exports = defineNamespace global
else
  @namespace = defineNamespace @
