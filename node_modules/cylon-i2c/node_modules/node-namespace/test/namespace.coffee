vows = require 'vows'
assert = require 'assert'

namespace = require '../lib/namespace'

vows
  .describe('Namespace tests')
  .addBatch
    'first level global namespace':
      topic: ->
        namespace 'Hello', ->
          class @World
            @level: '1-1'

      'namespace declared and contains target class': (topic) ->
        assert.equal Hello.World.level, '1-1'

      'namespace is global': (topic) ->
        assert.equal Hello.World, global.Hello.World

    'extend existing namespace':
      topic: ->
        namespace 'Hello.Second', ->
          class @World
            @level: '2-1'

      'namespace declared and contains target class': (topic)->
        assert.equal Hello.Second.World.level, '2-1'

      'previously declared class still available': (topic)->
        assert.equal Hello.World.level, '1-1'

    'create namespace in specified context':
      topic: ->
        namespace 'New', global.Hello, ->
          class @World
            @level: '3-1'

      'namespace declared in the desired context and contains target class': (topic)->
        assert.equal Hello.New.World.level, '3-1'

    'namespace creation in the non-Object context':
      topic: ->
        context = { Test: 'hello' }
        try
          namespace 'Test', context, ->
            class @World
              @level: '4-1'
        catch e
          context.errorCatched = e
        context

      'context untouched, error thrown, target class are not defined': (topic)->
        assert.equal topic.Test, 'hello'
        assert.equal topic.errorCatched instanceof Error, true
        assert.isUndefined topic.Test.World

  .export module
